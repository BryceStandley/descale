"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5725],{89705:function(e,n,t){t.d(n,{EM:function(){return c},_O:function(){return s},b8:function(){return d}});var i=t(5362),r=t(27218),u=t(27895),o=t(13262),a=t(10228),l=t(77930);let c=()=>{let{account:e,activeOrganization:n}=(0,r.t)(),t=null==e?void 0:e.uuid,c=null==n?void 0:n.uuid,{addError:d}=(0,u.e)(),s=(0,l.useQueryClient)();return(0,i.uC)("/api/organizations/".concat(c,"/sync/mcp/drive/ingest"),"POST",{onSuccess:()=>{setTimeout(()=>{s.invalidateQueries({queryKey:[o.dY,{orgUuid:c,accountUuid:t,syncSourceType:a.Fg.GDRIVE}]})},300)},onError:e=>{d(e)}})},d=()=>{let{activeOrganization:e}=(0,r.t)(),n=null==e?void 0:e.uuid,{addError:t}=(0,u.e)(),c=(0,l.useQueryClient)();return(0,i.uC)("/api/organizations/".concat(n,"/sync/ingestion/gdrive/clean_up"),"POST",{onSuccess:()=>{c.invalidateQueries({queryKey:[o.dY,{orgUuid:n,syncSourceType:a.Fg.GDRIVE}]})},onError:e=>{t(e)}})},s=e=>{let{activeOrganization:n}=(0,r.t)(),t=null==n?void 0:n.uuid;return(0,i.uC)("/api/organizations/".concat(t,"/projects/").concat(e,"/kb/resync"),"POST",{enabled:!!e,meta:{noToast:!0}})}},2949:function(e,n,t){t.d(n,{$Z:function(){return I},Aj:function(){return y},EU:function(){return D},En:function(){return C},MN:function(){return h},Mv:function(){return T},Xv:function(){return w},ez:function(){return O},mD:function(){return A},nC:function(){return S},oE:function(){return b},qZ:function(){return M},r7:function(){return L},td:function(){return z},u7:function(){return F}});var i=t(19170),r=t(5362),u=t(27218),o=t(13262),a=t(87033),l=t(10228),c=t(88755),d=t(77930),s=t(81695),v=t(7653),f=t(89705),g=t(51879),p=t(22534),_=t(19132);let m="gdrive_success",h=()=>{let e=(0,u.Cf)(),{data:n}=(0,_.tc)(),t=!!(Array.isArray(n)&&n.find(e=>e.type===l.Fg.GDRIVE&&e.enabled));return!e||t},y=()=>{let e=h(),{value:n}=(0,a.FL)("kingfisher_enabled");return!!(n&&e)},b=()=>{let{account:e,activeOrganization:n}=(0,u.t)(),t=null==n?void 0:n.uuid,i=y(),{data:a,isFetched:l}=(0,r.WE)("/api/organizations/".concat(t,"/sync/mcp/drive/auth"),{queryKey:[o.Yw,{accountUUID:null==e?void 0:e.uuid,orgUUID:t}],enabled:i,staleTime:3e5});return{isAuthenticated:i&&!!(null==a?void 0:a.is_authenticated),isFetched:l}},E=e=>{let{callerIdentifier:n}=e,t=(0,s.usePathname)(),{account:i,activeOrganization:a}=(0,u.t)(),l=null==i?void 0:i.uuid,f=null==a?void 0:a.uuid,g=y(),p=(0,s.useRouter)(),h=(0,d.useQueryClient)(),b=(0,c.Q)(),E=(0,s.useSearchParams)(),{mutate:S}=(0,r.uC)("/api/organizations/".concat(f,"/sync/mcp/drive/auth/start"),"POST",{enabled:g,onSuccess:e=>{p.push(e.redirect_url)}}),C=(0,v.useRef)(!1);return()=>{if(!g)return;let e="".concat(m,"=").concat(n),i=(0,_.LZ)({pathname:t,searchParams:E,queryString:e,isClaudeApp:b});if(h.invalidateQueries({queryKey:[o.Yw,{accountUUID:l,orgUUID:f}]}),b){window.open("/settings/profile?open_in_browser=1&auth_start=gdrive&origin=".concat(i));return}C.current||(C.current=!0,S({pre_auth_state:{origin:i},redirect_uri:new URL("/connect/mcp/drive/callback",window.location.origin).toString()}))}},S=function(){let{callerIdentifier:e,handleAuthSuccess:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{isAuthenticated:t,isFetched:i}=b(),{dropdownToOpen:r,clearCallerIdentifier:u}=(0,g.J)(),o=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null==n||n(e)},a=E({callerIdentifier:e});return(0,_.BZ)({callerIdentifier:e,successParam:m,handleOpen:o}),(0,v.useEffect)(()=>{e&&r===e&&(null==n||n(!0),u())},[r,n,e,u]),{isDriveAuthenticated:t,initDriveAuth:a,handleDriveTrigger:o,isFetched:i}},C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,u.t)(),i=null==n?void 0:n.uuid,a=null==t?void 0:t.uuid,l=y(),c=(0,d.useQueryClient)(),{mutate:s}=(0,f.b8)();return(0,r.uC)("/api/organizations/".concat(a,"/sync/mcp/drive/auth"),"DELETE",{enabled:!!(t&&l),...e,onSuccess:function(){for(var n,t=arguments.length,r=Array(t),u=0;u<t;u++)r[u]=arguments[u];c.invalidateQueries({queryKey:[o.Yw,{accountUUID:i,orgUUID:a}]}),s({}),null===(n=e.onSuccess)||void 0===n||n.call(e,...r)}})},T=e=>{let{documentId:n}=e,{account:t,activeOrganization:i}=(0,u.t)(),a=null==t?void 0:t.uuid,l=null==i?void 0:i.uuid,c=y(),s=(0,d.useQueryClient)(),f=(0,r.WE)("/api/organizations/".concat(l,"/sync/mcp/drive/document/").concat(n,"?include_content=false"),{queryKey:[o.HI,{accountUUID:a,orgUUID:l,documentId:n}],enabled:c,meta:{noToast:!0}}),g=f.isError;return(0,v.useEffect)(()=>{g&&s.invalidateQueries({queryKey:[o.Yw,{accountUUID:a,orgUUID:l}]})},[s,g,a,l]),f};function w(e){let{uri:n}=e,{data:t,isLoading:i}=T({documentId:n});return{title:null==t?void 0:t.title,isLoading:i}}let A=e=>{let{account:n,activeOrganization:t}=(0,u.t)(),i=null==n?void 0:n.uuid,a=null==t?void 0:t.uuid,l=y(),c=(0,v.useMemo)(()=>e.map(e=>"/api/organizations/".concat(a,"/sync/mcp/drive/document/").concat(e)),[e,a]),d=(0,v.useMemo)(()=>({queryKey:e.map(e=>[o.Yp,{accountUUID:i,orgUUID:a,documentId:e}]),enabled:l,meta:{noToast:!0}}),[e,i,a,l]);return(0,r.Nl)(c,d)},z=e=>{let{account:n,activeOrganization:t}=(0,u.t)(),i=null==n?void 0:n.uuid,a=null==t?void 0:t.uuid,l=y(),c=(0,p.F7)(),{data:d,isSuccess:s,isLoading:f}=(0,r.WE)("/api/organizations/".concat(a,"/sync/mcp/drive/recents"),{queryKey:[o.s8,{accountUUID:i,orgUUID:a}],enabled:e&&l,meta:{noToast:!0}});return(0,v.useEffect)(()=>{if(s&&d){let e=d.map(e=>{let{uri:n,title:t}=e;return{uri:n,title:t}});(0,p.MU)(e)}},[s,d]),{recentDriveDocs:s?d:c,isLoading:f}},I=()=>{let{value:e}=(0,a.FL)("apps_use_bananagrams");return e},O=()=>{let e=y(),{value:n}=(0,a.FL)("apps_use_bananagrams");return e&&n},D=e=>{var n;let t=O(),{account:i}=(0,u.t)();return!!t&&(e?!!(null==e?void 0:null===(n=e.conversationSettings)||void 0===n?void 0:n.enabled_bananagrams):!!(null==i?void 0:i.settings.enabled_bananagrams))},F=()=>(0,a.FL)("rag_prototype").value,L=()=>{let e=O(),n=(0,u.Cf)(),{data:t}=(0,_.tc)(),{account:i}=(0,u.t)(),r=F();return!!e&&!!r&&(n?!!(Array.isArray(t)&&t.find(e=>{var n;return e.type===l.Fg.GDRIVE&&e.enabled&&(null===(n=e.config)||void 0===n?void 0:n.allow_indexing)})):!!(null==i?void 0:i.settings.enabled_gdrive_indexing))},M=()=>{let{account:e}=(0,u.t)(),{mutate:n}=(0,i.Ck)(),{mutate:t}=(0,f.EM)();return{toggleDriveSearchAndIndexingEnabled:i=>{var r;let{indexingEnabled:u,searchEnabled:o,dismissBanner:a}=i,l=a||!!u;u&&t({}),n({...null==e?void 0:e.settings,...void 0!==u?{enabled_gdrive_indexing:u}:null,...void 0!==o||!0===u?{enabled_bananagrams:null!=u?u:o}:null,...l?{dismissed_claudeai_banners:[...(null==e?void 0:null===(r=e.settings)||void 0===r?void 0:r.dismissed_claudeai_banners)||[],{banner_id:"drive_indexing_enablement_2/11_1",dismissed_at:new Date().toISOString()}]}:null})}}}},89111:function(e,n,t){t.d(n,{H7:function(){return b},Mr:function(){return E},N:function(){return y},Y$:function(){return T},Yn:function(){return h}});var i,r,u,o,a=t(5362),l=t(27218),c=t(13262),d=t(10228),s=t(88755),v=t(77930),f=t(81695),g=t(7653),p=t(19132);let _="github_success";(i=u||(u={})).PENDING="pending",i.STARTED="started",i.COMPLETED="completed",i.FAILED="failed",(r=o||(o={})).PATH_NOT_FOUND="path_not_found",r.INVALID_SHA="invalid_sha",r.SIZE_LIMIT_EXCEEDED="size_limit_exceeded",r.SOURCE_MISSING_OR_CHANGED="source_missing_or_changed";let m=e=>{let{shouldFetch:n=!1}=e,{activeOrganization:t}=(0,l.t)(),i=null==t?void 0:t.uuid,r=b();return(0,a.WE)("/api/organizations/".concat(i,"/sync/github/auth"),{queryKey:[c.Os,{orgUUID:i}],enabled:!!(n&&t&&r)})},h=function(){var e;let{callerIdentifier:n,toggleGithubModalOpen:t,fetchImmediately:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:r}=(0,l.t)(),u=null==r?void 0:r.uuid,o=b(),c=(0,f.useRouter)(),[d,v]=(0,g.useState)(i),h=m({shouldFetch:d}),y=(0,g.useCallback)(async()=>{var e,n;return d?null===(n=h.data)||void 0===n?void 0:n.is_authenticated:(v(!0),null===(e=(await h.refetch()).data)||void 0===e?void 0:e.is_authenticated)},[h,d]),{mutate:E}=(0,a.uC)("/api/organizations/".concat(u,"/sync/github/auth/start"),"POST",{enabled:!!(r&&o),onSuccess:e=>{c.push(e.redirect_url)}}),S="".concat(_,"=").concat(n);(0,p.BZ)({callerIdentifier:n,successParam:_,handleOpen:()=>{null==t||t(!0)}});let C=(0,f.useSearchParams)(),T=(0,s.Q)(),w=(0,g.useRef)(!1),A=(0,f.usePathname)(),z=(0,p.LZ)({pathname:A,searchParams:C,queryString:S,isClaudeApp:T});return{checkIsGithubAuthenticated:y,initGithubAuth:()=>{if(o){if(T){window.open("/settings/profile?open_in_browser=1&auth_start=github&origin=".concat(z));return}w.current||(w.current=!0,E({pre_auth_state:{origin:z}}))}},isGithubAuthenticated:!!(null===(e=h.data)||void 0===e?void 0:e.is_authenticated)}},y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,l.t)(),t=null==n?void 0:n.uuid,i=b(),r=(0,v.useQueryClient)();return(0,a.uC)("/api/organizations/".concat(t,"/sync/github/auth"),"DELETE",{enabled:!!(n&&i),...e,onSuccess:function(){for(var n,i=arguments.length,u=Array(i),o=0;o<i;o++)u[o]=arguments[o];r.invalidateQueries({queryKey:[c.Os,{orgUUID:t}]}),null===(n=e.onSuccess)||void 0===n||n.call(e,...u)}})},b=()=>{let{data:e}=(0,p.tc)(),n=(0,l.Cf)(),t=!!(Array.isArray(e)&&e.find(e=>e.type===d.Fg.GITHUB&&e.enabled));return!!(!n||t)},E=()=>{let{activeOrganization:e}=(0,l.t)(),n=null==e?void 0:e.uuid,t=b();return(0,a.WE)("/api/organizations/".concat(n,"/sync/github/repos"),{queryKey:[c.wD,{orgUUID:n}],enabled:!!(e&&t),meta:{noToast:!0}})},S=e=>{let{owner:n,repo:t,branch:i}=e,{activeOrganization:r}=(0,l.t)(),u=null==r?void 0:r.uuid,o=b(),d=new URLSearchParams({owner:null!=n?n:"",repo:null!=t?t:""}).toString();return(0,a.WE)("/api/organizations/".concat(u,"/sync/github/repo?").concat(d),{queryKey:[c.Rz,{orgUUID:u,owner:n,repo:t}],enabled:!!(n&&t&&!i&&r&&o),meta:{noToast:!0}})},C=e=>{let{owner:n,repo:t,branch:i}=e,{activeOrganization:r}=(0,l.t)(),u=null==r?void 0:r.uuid,o=b();return(0,a.WE)("/api/organizations/".concat(u,"/sync/github/repo/").concat(n,"/").concat(t,"/tree/").concat(i),{queryKey:[c.E0,{orgUUID:u,owner:n,repo:t,branch:i}],staleTime:3e5,enabled:!!(n&&t&&i&&r&&o),meta:{noToast:!0}})},T=e=>{var n;let{owner:t,repo:i,branch:r}=e,u=S({owner:t,repo:i,branch:r}),o=C({owner:t,repo:i,branch:r||(null===(n=u.data)||void 0===n?void 0:n.default_branch)});return{data:{repo:u.data,tree:o.data},isFetching:u.isFetching||o.isFetching,error:u.error||o.error}}},61122:function(e,n,t){t.d(n,{$Y:function(){return C},KN:function(){return y},PQ:function(){return A},Vc:function(){return h},YB:function(){return S},cH:function(){return _},hX:function(){return p},ij:function(){return m},q:function(){return T},si:function(){return b},tF:function(){return E}}),t(95622);var i=t(19170),r=t(28803),u=t(3053),o=t(27218),a=t(87033),l=t(88755),c=t(76736),d=t.n(c),s=t(7653),v=t(41270),f=t(91217),g=t(85465);let p=(0,s.createContext)({mcpClients:{},servers:void 0,mcpTools:[],isLoading:!1,isEnabled:!1}),_=()=>{let e=(0,s.useContext)(p);return e||console.warn("useMcp being used outside of McpProvider, this is probably a bug"),e},m=()=>{let{value:e}=(0,a.FL)("papi_mcp");return e},h=()=>{let{value:e}=(0,a.FL)("mcp_local_ui");return e},y=()=>{let{value:e}=(0,a.FL)("claude_ai_allow_tool_always_allow");return e},b=()=>{let{activeOrganization:e}=(0,o.t)();return n=>{window.location.href="/api/organizations/".concat(null==e?void 0:e.uuid,"/mcp/start-auth/").concat(n,"?open_in_browser=1")}},E=()=>{let{servers:e}=_();return!!(0,l.Q)()&&((null==e?void 0:e.filter(e=>{let{type:n}=e;return"local"===n}))||[]).length>0},S=()=>{var e;let n=null!==(e=(0,g.gE)("enabled_mcp_tools"))&&void 0!==e?e:{};return(0,s.useMemo)(()=>Object.entries(n).filter(e=>{let[n,t]=e;return!!t}).map(e=>{let[n]=e;return n}),[n])},C=()=>{let{conversation:e}=(0,f.r)(),{account:n}=(0,o.t)(),{track:t}=(0,u.z$)(),{mutate:a}=(0,i.Ck)(),{mutate:l}=(0,r.T$)(null==e?void 0:e.id);return{toggleMcpToolEnabled:(i,r)=>{if(!n)return;let u=Array.isArray(i)?i.reduce((e,n)=>({...e,[n]:r}),{}):{[i]:r};if(e){var o;l({settings:{enabled_mcp_tools:{...null===(o=e.conversationSettings)||void 0===o?void 0:o.enabled_mcp_tools,...u}}})}let c=n.settings.enabled_mcp_tools;a({...n.settings,enabled_mcp_tools:{...c,...u}}),t({event_key:"claudeai.conversation.setting.toggled",conversation_uuid:(null==e?void 0:e.id)||null,setting:"enabled_mcp_tools.".concat(i),value:r})},toggleMcpToolAlwaysApproved:(e,t,i)=>{if(!n)return;let r=A(e,t),u=n.settings.enabled_mcp_tools;a({...n.settings,enabled_mcp_tools:{...u,[r]:i}})}}};function T(e,n){return"".concat(e,":").concat(n)}let w=v.z.object({description:v.z.string().optional(),type:v.z.string().optional(),title:v.z.string().optional()}).optional();function A(e,n){let t=T(e,n.name),i=n.description||"",r=function(e){var n;let t=Object.entries((null===(n=e.inputSchema)||void 0===n?void 0:n.properties)||{}),i=[];for(let[e,n]of t){let{data:t}=w.safeParse(n),r=(null==t?void 0:t.description)||"";i.push([e,r])}return i.sort((e,n)=>e[0].localeCompare(n[0])).flat().join(",")}(n),u=d().createHash("md5").update("".concat(i,":").concat(r)).digest("hex");return"".concat(t,"-").concat(u)}},74339:function(e,n,t){t.d(n,{J$:function(){return c},Zf:function(){return l},fX:function(){return s},gQ:function(){return a},vc:function(){return d}});var i=t(5362),r=t(27218),u=t(13262);t(10228),t(7653);var o=t(19132);let a=e=>{let{documentId:n}=e,{account:t,activeOrganization:o}=(0,r.t)(),a=null==t?void 0:t.uuid,l=null==o?void 0:o.uuid,d=c();return(0,i.WE)("/api/organizations/".concat(l,"/sync/mcp/outline/document/").concat(n),{queryKey:[u.q2,{accountUUID:a,orgUUID:l,documentId:n}],enabled:d})},l=e=>{let{uri:n}=e,{data:t,isLoading:i}=a({documentId:n});return{title:null==t?void 0:t.title,isLoading:i}},c=()=>{let{data:e}=(0,o.tc)();return!1},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,r.t)(),o=null==t?void 0:t.uuid,a=c(),{data:l,refetch:d}=(0,i.WE)("/api/organizations/".concat(o,"/sync/mcp/outline/auth"),{queryKey:[u.Sp,{accountUUID:null==n?void 0:n.uuid,orgUUID:o}],enabled:!!(t&&a),staleTime:5e3}),{mutate:s,isPending:v}=(0,i.uC)("/api/organizations/".concat(o,"/sync/mcp/outline/auth/start"),"POST",{enabled:!!(t&&a),...e,onSuccess:function(){for(var n,t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];null===(n=e.onSuccess)||void 0===n||n.call(e,...i)}});return{isOutlineAuthenticated:!!(null==l?void 0:l.is_authenticated),refetch:d,initOutlineAuth:s,isLoadingOutlineAuthInit:v}},s=()=>{let e=encodeURIComponent(window.location.href);window.location.href="/settings/profile?redirect_url=".concat(e,"&open_outline_auth=true")}},85465:function(e,n,t){t.d(n,{M0:function(){return p},gE:function(){return g},lP:function(){return f}});var i=t(19170),r=t(28803),u=t(3053),o=t(27218),a=t(10228),l=t(98649),c=t(91217),d=t(2949),s=t(89111),v=t(74339);let f=()=>{let{initGithubAuth:e}=(0,s.Yn)(),{initDriveAuth:n}=(0,d.nC)();return t=>{t===a.Fg.GITHUB?e():t===a.Fg.GDRIVE?n():t===a.Fg.OUTLINE&&(0,v.fX)()}},g=e=>{let{conversation:n,pendingConversationSettings:t}=(0,c.r)(),{account:i}=(0,o.t)();if(n){var r;return null===(r=n.conversationSettings)||void 0===r?void 0:r[e]}return l.xm.includes(e)?null==i?void 0:i.settings[e]:null==t?void 0:t[e]},p=()=>{let{conversation:e,setPendingConversationSettings:n}=(0,c.r)(),{account:t}=(0,o.t)(),{track:a}=(0,u.z$)(),{mutate:d}=(0,i.Ck)(),{mutate:s}=(0,r.T$)(null==e?void 0:e.id);return{toggleConversationSetting:(i,r)=>{if(!t)return;let u={};e&&s({settings:{[i]:r,...u}}),l.xm.includes(i)?d({...t.settings,[i]:r}):l.YA.includes(i)&&!e&&n({[i]:r,...u}),a({event_key:"claudeai.conversation.setting.toggled",conversation_uuid:(null==e?void 0:e.id)||null,setting:i,value:r})}}}},51879:function(e,n,t){t.d(n,{J:function(){return c},Q:function(){return l}});var i=t(27573),r=t(35919),u=t.n(r),o=t(7653);let a=(0,o.createContext)({isOpen:!1,dropdownToOpen:void 0,openModal:u(),closeModal:u(),clearCallerIdentifier:u()}),l=e=>{let{children:n}=e,[t,r]=(0,o.useState)(!1),u=(0,o.useRef)(void 0),[l,c]=(0,o.useState)(void 0);return(0,i.jsx)(a.Provider,{value:{isOpen:t,openModal:e=>{r(!0),u.current=e},closeModal:()=>{r(!1),c(u.current)},dropdownToOpen:l,clearCallerIdentifier:()=>{c(void 0)}},children:n})},c=()=>(0,o.useContext)(a)},11607:function(e,n,t){t.r(n),t.d(n,{Loading:function(){return a}});var i=t(27573),r=t(10607),u=t(7653),o=t(45790);let a=(0,u.memo)(function(e){let{size:n="md",fullscreen:t=!1,inheritColor:a,delay:l=0}=e,[c,d]=(0,u.useState)(l>0);return(0,u.useEffect)(()=>{if(!l)return;let e=setTimeout(()=>d(!1),l);return()=>clearTimeout(e)},[l]),(0,i.jsx)("div",{className:(0,r.Z)(t?"fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2":"m-auto"),children:(0,i.jsx)("div",{className:(0,r.Z)("sm"===n&&"h-4 w-4 border-2","md"===n&&"h-20 w-20 border-8",a?"border-current":"border-border-200","text-secondary inline-block animate-spin rounded-full border-solid border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",c&&"hidden"),role:"status",children:(0,i.jsx)("span",{className:"sr-only",children:(0,i.jsx)(o.Z,{defaultMessage:"Loading...",id:"gjBiyjshwX"})})})})})}}]);